<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eng. Hesham Mahran | LNU Archive Pro</title>
    <style>
        :root { 
            --primary: #0f172a; --accent: #fbbf24; --section-color: #38bdf8; 
            --danger: #ef4444; --success: #10b981; --trash: #94a3b8; 
            --main-bg-image: url("https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg"); 
        }

        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            margin: 0; padding: 0; color: #fff; overflow-x: hidden;
            background: #0b0f19; min-height: 100vh;
        }

        body::before {
            content: ""; position: fixed; inset: 0;
            background: linear-gradient(rgba(11, 15, 25, 0.9), rgba(11, 15, 25, 0.9)), 
                        var(--main-bg-image) no-repeat center center fixed; 
            background-size: cover; z-index: -1; will-change: transform;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px 15px; }
        header { text-align: center; margin-bottom: 30px; }
        header h1 { color: var(--accent); font-size: clamp(2em, 8vw, 3em); margin: 0; text-shadow: 0 0 15px rgba(251, 191, 36, 0.3); }

        .trash-nav { display: flex; justify-content: flex-start; margin-bottom: 10px; }
        .btn-trash-box { 
            background: rgba(255,255,255,0.05); border: 1px solid var(--trash); color: var(--trash); 
            padding: 8px 12px; border-radius: 12px; cursor: pointer; font-weight: bold;
            display: flex; align-items: center; gap: 8px; transition: 0.2s;
        }

        .folder-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; }
        
        .subject-card { 
            height: 190px; border-radius: 20px; position: relative; overflow: hidden;
            cursor: pointer; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid rgba(255,255,255,0.1);
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 8px 15px rgba(0,0,0,0.3); contain: layout;
        }
        .subject-card:hover { transform: translateY(-8px) scale(1.02); border-color: var(--accent); box-shadow: 0 12px 25px rgba(251, 191, 36, 0.2); }
        .icon-box { font-size: 2.8em; z-index: 2; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); }
        .card-overlay { position: absolute; bottom: 0; width: 100%; padding: 12px; background: rgba(0,0,0,0.85); text-align: center; font-weight: bold; font-size: 1em; border-top: 1px solid rgba(255,255,255,0.1); }
        .section-tag { position: absolute; top: 12px; left: 12px; background: var(--section-color); color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.75em; font-weight: bold; z-index: 3; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        .page { display: none; background: rgba(15, 23, 42, 0.98); backdrop-filter: blur(15px); border-radius: 25px; padding: 25px; margin-top: 15px; animation: fadeIn 0.3s ease-out; border: 1px solid rgba(255,255,255,0.1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .file-row { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .file-info { flex: 1; }
        .file-name { font-weight: bold; color: var(--accent); display: block; margin-bottom: 4px; }
        .file-meta { font-size: 0.8em; color: #cbd5e1; }

        .btn { padding: 10px 18px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-view { background: var(--success); color: white; }
        .btn-delete { background: var(--danger); color: white; margin-right: 5px; }
        .btn-restore { background: var(--section-color); color: white; }

        #viewer { position: fixed; inset: 0; background: #000; display: none; flex-direction: column; z-index: 9999; }
        #vFrame { flex-grow: 1; border: none; background: #fff; }
    </style>
</head>
<body>

<div id="homeScreen" class="container">
    <header>
        <div class="trash-nav">
            <button class="btn-trash-box" onclick="openTrash()">
                <span>ğŸ—‘ Ø§Ù„Ø³Ù„Ø©</span>
                <span id="trashCount">0</span>
            </button>
        </div>
        <h1>Eng. Hesham Mahran</h1>
        <p>LNU Archive | Advanced Engineering System</p>
    </header>
    <div class="folder-grid" id="folderGrid"></div>
</div>

<div id="subjectPage" class="container page">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <button class="btn" style="background:#444;" onclick="goHome()">â¬… Ø¹ÙˆØ¯Ø©</button>
        <h2 id="currentTitle" style="color:var(--accent); margin:0;"></h2>
        <a id="ytLink" href="#" target="_blank" class="btn" style="background:#ff0000; color:white;">YouTube</a>
    </div>
    
    <div style="background:rgba(255,255,255,0.02); padding:20px; border-radius:20px; text-align:center; border: 1px dashed #555;">
        <input type="text" id="fileNotes" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù„Ù„Ù…Ù„Ù Ù‡Ù†Ø§..." style="width:85%; padding:12px; border-radius:10px; border:none; margin-bottom:15px; background:#000; color:#fff; text-align:center; font-family: inherit;">
        <br>
        <input type="file" id="fileInput" hidden onchange="handleUpload(this)">
        <button class="btn" style="background:var(--accent); color:#000; width:100%; max-width: 300px;" onclick="document.getElementById('fileInput').click()">+ Ø§Ø±ÙØ¹ Ù…Ù„Ù</button>
    </div>
    
    <div id="fileList" style="margin-top:30px;"></div>
</div>

<div id="trashPage" class="container page">
    <button class="btn" style="background:#444;" onclick="goHome()">â¬… Ø¹ÙˆØ¯Ø©</button>
    <h2 style="text-align:center; color:var(--trash);">ğŸ—‘ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª</h2>
    <div id="trashList"></div>
    <div id="trashControls" style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
        <button class="btn btn-delete" style="width: 100%; max-width: 400px;" onclick="emptyTrash()">Ø­Ø°Ù Ø§Ù„ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ğŸ’€</button>
    </div>
</div>

<div id="viewer">
    <div style="padding:15px; background:#111; display:flex; justify-content:space-between; align-items:center;">
        <span id="vFileName" style="color:var(--accent);">Ù…Ø¹Ø§ÙŠÙ†Ø©</span>
        <button class="btn" style="background:var(--danger);" onclick="closeViewer()">Ø¥ØºÙ„Ø§Ù‚ âœ–</button>
    </div>
    <iframe id="vFrame"></iframe>
</div>

<script>
    // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙˆØ§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
    const subjects = [
        { id: 1, name: "Ù‚Ø¶Ø§ÙŠØ§ Ù…Ø¬ØªÙ…Ø¹ÙŠØ©", icon: "âš–ï¸", yt: "https://youtube.com/playlist?list=PL4Haigbjr7Kou8d9nZ90H-A_LlC60Vp_8", img: "https://images.pexels.com/photos/606541/pexels-photo-606541.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 2, name: "Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ù…Ù†Ø·Ù‚", icon: "ğŸ”Œ", yt: "https://youtube.com/playlist?list=PLhx4zaYkEjI8BuPybYhAotW2gKDIT9y2D", img: "https://images.pexels.com/photos/2582937/pexels-photo-2582937.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 3, name: "Ø±ÙŠØ§Ø¶Ø© 2", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PL0TpXNlUp4HYesKP8AJ21-kFG1Swxt_El", img: "https://images.pexels.com/photos/623919/pexels-photo-623919.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 4, name: "ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø© OOP", icon: "ğŸ—ï¸", yt: "https://youtube.com/playlist?list=PLCInYL3l2AagY7fFlhCrjpLiIFybW3yQv", img: "https://images.pexels.com/photos/1181263/pexels-photo-1181263.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 5, name: "Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹", icon: "ğŸŒ", yt: "https://youtube.com/playlist?list=PLknwEmKsW8OtLRQPTLms79499meY2D6ij", img: "https://images.pexels.com/photos/1779487/pexels-photo-1779487.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 6, name: "Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", icon: "ğŸ§ ", yt: "https://youtube.com/playlist?list=PLhiFu-f80eo-h0whWvRsE1KL_A08wpmSB", img: "https://images.pexels.com/photos/8386440/pexels-photo-8386440.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 7, name: "Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù…ØªÙ‚Ø·Ø¹Ø©", icon: "ğŸ”¢", yt: "https://youtube.com/playlist?list=PLxIvc-MGOs6gZlMVYOOEtUHJmfUquCjwz", img: "https://images.pexels.com/photos/3729512/pexels-photo-3729512.jpeg?auto=compress&w=600", type: "lecture" },
        
        { id: 202, name: "Section Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ù…Ù†Ø·Ù‚", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLhx4zaYkEjI8BuPybYhAotW2gKDIT9y2D", img: "https://images.pexels.com/photos/3825586/pexels-photo-3825586.jpeg?auto=compress&w=600", type: "section" },
        { id: 203, name: "Section Ø±ÙŠØ§Ø¶Ø© 2", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PL0TpXNlUp4HYesKP8AJ21-kFG1Swxt_El", img: "https://images.pexels.com/photos/1321328/pexels-photo-1321328.jpeg?auto=compress&w=600", type: "section" },
        { id: 204, name: "Section ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø© OOP", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLCInYL3l2AagY7fFlhCrjpLiIFybW3yQv", img: "https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&w=600", type: "section" },
        { id: 205, name: "Section Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLknwEmKsW8OtLRQPTLms79499meY2D6ij", img: "https://images.pexels.com/photos/270404/pexels-photo-270404.jpeg?auto=compress&w=600", type: "section" },
        { id: 206, name: "Section Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLhiFu-f80eo-h0whWvRsE1KL_A08wpmSB", img: "https://images.pexels.com/photos/3913025/pexels-photo-3913025.jpeg?auto=compress&w=600", type: "section" },
        { id: 207, name: "Section Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù…ØªÙ‚Ø·Ø¹Ø©", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLxIvc-MGOs6gZlMVYOOEtUHJmfUquCjwz", img: "https://images.pexels.com/photos/5426401/pexels-photo-5426401.jpeg?auto=compress&w=600", type: "section" }
    ];

    let db; let storeName = "";
    const req = indexedDB.open("EngHeshamFinal_v11", 1);
    
    req.onsuccess = e => { db = e.target.result; updateTrashCounter(); renderHome(); };
    req.onupgradeneeded = e => {
        db = e.target.result;
        subjects.forEach(s => db.createObjectStore("sub_"+s.id, { keyPath: "id", autoIncrement: true }));
        db.createObjectStore("recycle_bin", { keyPath: "id", autoIncrement: true });
    };

    function renderHome() {
        document.getElementById('homeScreen').style.display = 'block';
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        const grid = document.getElementById('folderGrid');
        grid.innerHTML = subjects.map(s => `
            <div class="subject-card" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${s.img}')" onclick="openSubject(${s.id}, '${s.name}', '${s.yt}')">
                ${s.type === 'section' ? '<div class="section-tag">Section</div>' : ''}
                <div class="icon-box">${s.icon}</div>
                <div class="card-overlay">${s.name}</div>
            </div>
        `).join('');
    }

    function openSubject(id, name, yt) { 
        storeName = "sub_"+id; 
        document.getElementById('homeScreen').style.display = 'none'; 
        document.getElementById('subjectPage').style.display = 'block'; 
        document.getElementById('currentTitle').innerText = name; 
        document.getElementById('ytLink').href = yt; 
        loadFiles(); 
    }

    function handleUpload(input) {
        const file = input.files[0]; if(!file) return;
        const noteText = document.getElementById('fileNotes').value || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª";
        const reader = new FileReader();
        reader.onload = e => {
            const tx = db.transaction(storeName, "readwrite");
            tx.objectStore(storeName).add({ 
                name: file.name, type: file.type, data: e.target.result, 
                notes: noteText, date: new Date().toLocaleDateString('ar-EG') 
            });
            tx.oncomplete = () => { document.getElementById('fileNotes').value = ""; loadFiles(); };
        };
        reader.readAsArrayBuffer(file);
    }

    function loadFiles() {
        const list = document.getElementById('fileList');
        db.transaction(storeName, "readonly").objectStore(storeName).getAll().onsuccess = e => {
            list.innerHTML = e.target.result.map(f => `
                <div class="file-row">
                    <div class="file-info">
                        <span class="file-name">${f.name}</span>
                        <span class="file-meta">ğŸ“ ${f.notes} | ğŸ“… ${f.date}</span>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-view" onclick="viewFile('${storeName}', ${f.id})">ğŸ‘€</button>
                        <button class="btn btn-delete" onclick="moveToTrash(${f.id})">ğŸ—‘</button>
                    </div>
                </div>`).join('');
        };
    }

    function viewFile(store, id) {
        db.transaction(store, "readonly").objectStore(store).get(id).onsuccess = e => {
            const f = e.target.result;
            const blob = new Blob([f.data], { type: f.type });
            const url = URL.createObjectURL(blob);
            if (f.type.includes('image')) {
                document.getElementById('vFrame').src = url;
                document.getElementById('vFileName').innerText = f.name;
                document.getElementById('viewer').style.display = 'flex';
            } else {
                window.open(url, '_blank');
            }
        };
    }

    function closeViewer() { document.getElementById('viewer').style.display = 'none'; document.getElementById('vFrame').src = ""; }
    
    function moveToTrash(id) { 
        const tx = db.transaction([storeName, "recycle_bin"], "readwrite"); 
        tx.objectStore(storeName).get(id).onsuccess = e => { 
            const file = e.target.result; 
            file.originalStore = storeName; 
            tx.objectStore("recycle_bin").add(file); 
            tx.objectStore(storeName).delete(id); 
        }; 
        tx.oncomplete = () => { loadFiles(); updateTrashCounter(); }; 
    }

    function updateTrashCounter() { 
        db.transaction("recycle_bin", "readonly").objectStore("recycle_bin").count().onsuccess = e => { 
            document.getElementById('trashCount').innerText = e.target.result; 
        }; 
    }

    function openTrash() { 
        document.getElementById('homeScreen').style.display = 'none'; 
        document.getElementById('trashPage').style.display = 'block'; 
        loadTrash(); 
    }

    function loadTrash() { 
        const list = document.getElementById('trashList'); 
        db.transaction("recycle_bin", "readonly").objectStore("recycle_bin").getAll().onsuccess = e => { 
            list.innerHTML = e.target.result.map(f => `
                <div class="file-row">
                    <div class="file-info">
                        <span class="file-name">${f.name}</span>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-restore" onclick="restoreFile(${f.id}, '${f.originalStore}')" title="Ø§Ø³ØªØ¹Ø§Ø¯Ø©">ğŸ”„</button>
                        <button class="btn btn-delete" onclick="deleteForever(${f.id})" title="Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ">âŒ</button>
                    </div>
                </div>`).join(''); 
        }; 
    }

    function restoreFile(id, target) { 
        const tx = db.transaction(["recycle_bin", target], "readwrite"); 
        tx.objectStore("recycle_bin").get(id).onsuccess = e => { 
            const file = e.target.result; 
            delete file.originalStore; 
            tx.objectStore(target).add(file); 
            tx.objectStore("recycle_bin").delete(id); 
        }; 
        tx.oncomplete = () => { loadTrash(); updateTrashCounter(); }; 
    }

    function deleteForever(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            const tx = db.transaction("recycle_bin", "readwrite");
            tx.objectStore("recycle_bin").delete(id);
            tx.oncomplete = () => { loadTrash(); updateTrashCounter(); };
        }
    }

    function emptyTrash() {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙØ±Ø§Øº Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ©!")) {
            const tx = db.transaction("recycle_bin", "readwrite");
            tx.objectStore("recycle_bin").clear();
            tx.oncomplete = () => { loadTrash(); updateTrashCounter(); };
        }
    }

    function goHome() { renderHome(); }
</script>
</body>
</html>