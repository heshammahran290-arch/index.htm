<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/605/605110.png">
    <title>Eng. Hesham Mahran | LNU Archive Pro</title>
    <style>
        /* Ø³ØªØ§ÙŠÙ„Ø§ØªÙƒ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØºÙŠÙŠØ± */
        :root { 
            --primary: #0f172a; --accent: #fbbf24; --section-color: #38bdf8; 
            --danger: #ef4444; --success: #10b981; --trash: #94a3b8; 
            --main-bg-image: url("https://images.pexels.com/photos/3183150/pexels-photo-3183150.jpeg"); 
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; padding: 0; color: #fff; overflow-x: hidden; background: #0b0f19; min-height: 100vh; }
        body::before { content: ""; position: fixed; inset: 0; background: linear-gradient(rgba(11, 15, 25, 0.9), rgba(11, 15, 25, 0.9)), var(--main-bg-image) no-repeat center center fixed; background-size: cover; z-index: -1; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px 15px; }
        header { text-align: center; margin-bottom: 30px; }
        header h1 { color: var(--accent); font-size: clamp(2em, 8vw, 3em); margin: 0; text-shadow: 0 0 15px rgba(251, 191, 36, 0.3); }
        .trash-nav { display: flex; justify-content: flex-start; margin-bottom: 10px; }
        .btn-trash-box { background: rgba(255,255,255,0.05); border: 1px solid var(--trash); color: var(--trash); padding: 8px 12px; border-radius: 12px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .folder-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; }
        .subject-card { height: 190px; border-radius: 20px; position: relative; overflow: hidden; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); background-size: cover; background-position: center; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .subject-card:hover { transform: translateY(-8px); border-color: var(--accent); }
        .icon-box { font-size: 2.8em; z-index: 2; }
        .card-overlay { position: absolute; bottom: 0; width: 100%; padding: 12px; background: rgba(0,0,0,0.85); text-align: center; font-weight: bold; }
        .section-tag { position: absolute; top: 12px; left: 12px; background: var(--section-color); color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.75em; font-weight: bold; z-index: 3; }
        .page { display: none; background: rgba(15, 23, 42, 0.98); backdrop-filter: blur(15px); border-radius: 25px; padding: 25px; margin-top: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .tabs-nav { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; }
        .tab-btn { background: rgba(255,255,255,0.1); color: #fff; padding: 10px 20px; border-radius: 10px; border: none; cursor: pointer; flex: 1; font-weight: bold; }
        .tab-btn.active { background: var(--accent); color: #000; }
        .file-row { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .file-info { flex: 1; }
        .file-name { font-weight: bold; color: var(--accent); display: block; }
        .btn { padding: 10px 18px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; }
        .btn-view { background: var(--success); color: white; }
        .btn-delete { background: var(--danger); color: white; }
        #viewer { position: fixed; inset: 0; background: #000; display: none; flex-direction: column; z-index: 9999; }
        #vFrame { flex-grow: 1; border: none; background: #fff; }
    </style>
</head>
<body>

<div id="homeScreen" class="container">
    <header>
        <div class="trash-nav"><button class="btn-trash-box" onclick="openTrash()">ğŸ—‘ Ø§Ù„Ø³Ù„Ø© <span id="trashCount">0</span></button></div>
        <h1>Eng. Hesham Mahran</h1>
        <p>LNU Archive | Advanced Engineering System</p>
    </header>
    <div class="folder-grid" id="folderGrid"></div>
</div>

<div id="subjectPage" class="container page">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <button class="btn" style="background:#444; color:white;" onclick="goHome()">â¬… Ø¹ÙˆØ¯Ø©</button>
        <h2 id="currentTitle" style="color:var(--accent); margin:0;"></h2>
        <a id="ytLink" href="#" target="_blank" class="btn" style="background:#ff0000; color:white;">YouTube</a>
    </div>
    <div class="tabs-nav">
        <button id="tabFiles" class="tab-btn active" onclick="switchTab('files')">ğŸ“ Folder</button>
        <button id="tabAssignments" class="tab-btn" onclick="switchTab('assignments')">ğŸ“ Assignment</button>
    </div>
    <div style="background:rgba(255,255,255,0.02); padding:20px; border-radius:20px; text-align:center; border: 1px dashed #555;">
        <input type="text" id="fileNotes" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ..." style="width:85%; padding:12px; border-radius:10px; border:none; margin-bottom:15px; background:#000; color:#fff; text-align:center;">
        <br>
        <input type="file" id="fileInput" hidden onchange="handleUpload(this)">
        <button id="uploadBtn" class="btn" style="background:var(--accent); color:#000; width:100%; max-width: 300px;" onclick="document.getElementById('fileInput').click()">+ Ø§Ø±ÙØ¹ Ù…Ù„Ù</button>
    </div>
    <div id="fileList" style="margin-top:30px;"></div>
</div>

<div id="trashPage" class="container page">
    <button class="btn" style="background:#444; color:white;" onclick="goHome()">â¬… Ø¹ÙˆØ¯Ø©</button>
    <h2 style="text-align:center; color:var(--trash);">ğŸ—‘ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª</h2>
    <div id="trashList"></div>
    <div style="text-align: center; margin-top: 20px;"><button class="btn btn-delete" onclick="emptyTrash()">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</button></div>
</div>

<div id="viewer">
    <div style="padding:15px; background:#111; display:flex; justify-content:space-between; align-items:center;">
        <span id="vFileName" style="color:var(--accent);">Ù…Ø¹Ø§ÙŠÙ†Ø©</span>
        <button class="btn" style="background:var(--danger); color:white;" onclick="closeViewer()">Ø¥ØºÙ„Ø§Ù‚ âœ–</button>
    </div>
    <iframe id="vFrame"></iframe>
</div>

<script>
    const subjects = [
        { id: 1, name: "Ù‚Ø¶Ø§ÙŠØ§ Ù…Ø¬ØªÙ…Ø¹ÙŠØ©", icon: "âš–ï¸", yt: "https://youtube.com/playlist?list=PL4Haigbjr7Kou8d9nZ90H-A_LlC60Vp_8", img: "https://images.pexels.com/photos/606541/pexels-photo-606541.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 2, name: "Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ù…Ù†Ø·Ù‚", icon: "ğŸ”Œ", yt: "https://youtube.com/playlist?list=PLhx4zaYkEjI8BuPybYhAotW2gKDIT9y2D", img: "https://images.pexels.com/photos/2582937/pexels-photo-2582937.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 3, name: "Ø±ÙŠØ§Ø¶Ø© 2", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PL0TpXNlUp4HYesKP8AJ21-kFG1Swxt_El", img: "https://images.pexels.com/photos/623919/pexels-photo-623919.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 4, name: "ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø© OOP", icon: "ğŸ—ï¸", yt: "https://youtube.com/playlist?list=PLCInYL3l2AagY7fFlhCrjpLiIFybW3yQv", img: "https://images.pexels.com/photos/1181263/pexels-photo-1181263.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 5, name: "Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹", icon: "ğŸŒ", yt: "https://youtube.com/playlist?list=PLknwEmKsW8OtLRQPTLms79499meY2D6ij", img: "https://images.pexels.com/photos/1779487/pexels-photo-1779487.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 6, name: "Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", icon: "ğŸ§ ", yt: "https://youtube.com/playlist?list=PLhiFu-f80eo-h0whWvRsE1KL_A08wpmSB", img: "https://images.pexels.com/photos/8386440/pexels-photo-8386440.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 7, name: "Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù…ØªÙ‚Ø·Ø¹Ø©", icon: "ğŸ”¢", yt: "https://youtube.com/playlist?list=PLxIvc-MGOs6gZlMVYOOEtUHJmfUquCjwz", img: "https://images.pexels.com/photos/3729512/pexels-photo-3729512.jpeg?auto=compress&w=600", type: "lecture" },
        { id: 202, name: "Section Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ù…Ù†Ø·Ù‚", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLhx4zaYkEjI8BuPybYhAotW2gKDIT9y2D", img: "https://images.pexels.com/photos/3825586/pexels-photo-3825586.jpeg?auto=compress&w=600", type: "section" },
        { id: 203, name: "Section Ø±ÙŠØ§Ø¶Ø© 2", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PL0TpXNlUp4HYesKP8AJ21-kFG1Swxt_El", img: "https://images.pexels.com/photos/1321328/pexels-photo-1321328.jpeg?auto=compress&w=600", type: "section" },
        { id: 204, name: "Section ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø© OOP", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLCInYL3l2AagY7fFlhCrjpLiIFybW3yQv", img: "https://images.pexels.com/photos/1181671/pexels-photo-1181671.jpeg?auto=compress&w=600", type: "section" },
        { id: 205, name: "Section Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLknwEmKsW8OtLRQPTLms79499meY2D6ij", img: "https://images.pexels.com/photos/270404/pexels-photo-270404.jpeg?auto=compress&w=600", type: "section" },
        { id: 206, name: "Section Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLhiFu-f80eo-h0whWvRsE1KL_A08wpmSB", img: "https://images.pexels.com/photos/3913025/pexels-photo-3913025.jpeg?auto=compress&w=600", type: "section" },
        { id: 207, name: "Section Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù…ØªÙ‚Ø·Ø¹Ø©", icon: "ğŸ“", yt: "https://youtube.com/playlist?list=PLxIvc-MGOs6gZlMVYOOEtUHJmfUquCjwz", img: "https://images.pexels.com/photos/5426401/pexels-photo-5426401.jpeg?auto=compress&w=600", type: "section" }
    ];

    let db; let storeName = ""; let currentCategory = "files";

    // ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - ØºÙŠØ±Øª Ø§Ù„Ø§Ø³Ù… Ù„Ø¶Ù…Ø§Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    const req = indexedDB.open("EngHesham_Fixed_V1", 1);
    req.onupgradeneeded = e => {
        db = e.target.result;
        subjects.forEach(s => db.createObjectStore("sub_"+s.id, { keyPath: "id", autoIncrement: true }));
        db.createObjectStore("recycle_bin", { keyPath: "id", autoIncrement: true });
    };
    req.onsuccess = e => { db = e.target.result; updateTrashCounter(); renderHome(); };

    function renderHome() {
        document.getElementById('homeScreen').style.display = 'block';
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        const grid = document.getElementById('folderGrid');
        grid.innerHTML = subjects.map(s => `
            <div class="subject-card" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${s.img}')" onclick="openSubject(${s.id}, '${s.name}', '${s.yt}')">
                ${s.type === 'section' ? '<div class="section-tag">Section</div>' : ''}
                <div class="icon-box">${s.icon}</div>
                <div class="card-overlay">${s.name}</div>
            </div>`).join('');
    }

    function openSubject(id, name, yt) { 
        storeName = "sub_"+id; 
        document.getElementById('homeScreen').style.display = 'none'; 
        document.getElementById('subjectPage').style.display = 'block'; 
        document.getElementById('currentTitle').innerText = name; 
        document.getElementById('ytLink').href = yt; 
        switchTab('files'); 
    }

    function switchTab(cat) {
        currentCategory = cat;
        document.getElementById('tabFiles').className = cat === 'files' ? 'tab-btn active' : 'tab-btn';
        document.getElementById('tabAssignments').className = cat === 'assignments' ? 'tab-btn active' : 'tab-btn';
        loadFiles();
    }

    // Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…ØµÙ„Ø­: ÙŠØ®Ø²Ù† Ø§Ù„Ù…Ù„Ù ÙƒÙ€ Blob Ù…Ø¨Ø§Ø´Ø±Ø© (Ø£Ø³Ø±Ø¹ ÙˆÙ„Ø§ ÙŠØ³Ø¨Ø¨ ØªÙ‡Ù†ÙŠØ¬)
    function handleUpload(input) {
        const file = input.files[0]; if(!file) return;
        const btn = document.getElementById('uploadBtn');
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸... â³"; btn.disabled = true;

        const tx = db.transaction(storeName, "readwrite");
        tx.objectStore(storeName).add({ 
            name: file.name, type: file.type, data: file, 
            notes: document.getElementById('fileNotes').value || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª", 
            category: currentCategory, date: new Date().toLocaleDateString('ar-EG') 
        });
        tx.oncomplete = () => { 
            btn.innerText = "+ Ø§Ø±ÙØ¹ Ù…Ù„Ù"; btn.disabled = false;
            document.getElementById('fileNotes').value = ""; loadFiles(); 
        };
    }

    function loadFiles() {
        const list = document.getElementById('fileList');
        db.transaction(storeName, "readonly").objectStore(storeName).getAll().onsuccess = e => {
            const filtered = e.target.result.filter(f => (f.category || 'files') === currentCategory);
            list.innerHTML = filtered.map(f => `
                <div class="file-row">
                    <div class="file-info"><span class="file-name">${f.name}</span><small style="color:#aaa;">${f.notes}</small></div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-view" onclick="viewFile('${storeName}', ${f.id})">ğŸ‘€</button>
                        <button class="btn btn-delete" onclick="moveToTrash(${f.id})">ğŸ—‘</button>
                    </div>
                </div>`).join('') || "<p style='text-align:center;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª</p>";
        };
    }

    // Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…ØµÙ„Ø­: ÙŠØ¹Ù…Ù„ ÙÙŠ Transaction ÙˆØ§Ø­Ø¯Ø© Ø³Ø±ÙŠØ¹Ø© Ø¬Ø¯Ø§Ù‹
    function moveToTrash(id) {
        const tx = db.transaction([storeName, "recycle_bin"], "readwrite");
        const source = tx.objectStore(storeName);
        const trash = tx.objectStore("recycle_bin");

        source.get(id).onsuccess = e => {
            const file = e.target.result;
            if(file) {
                file.originalStore = storeName;
                trash.add(file);
                source.delete(id);
            }
        };
        tx.oncomplete = () => { loadFiles(); updateTrashCounter(); };
    }

    function viewFile(store, id) {
        db.transaction(store, "readonly").objectStore(store).get(id).onsuccess = e => {
            const f = e.target.result;
            const url = URL.createObjectURL(f.data);
            if (f.type.includes('image')) {
                document.getElementById('vFrame').src = url;
                document.getElementById('viewer').style.display = 'flex';
            } else { window.open(url, '_blank'); }
        };
    }

    function updateTrashCounter() {
        db.transaction("recycle_bin", "readonly").objectStore("recycle_bin").count().onsuccess = e => {
            document.getElementById('trashCount').innerText = e.target.result;
        };
    }

    function openTrash() {
        document.getElementById('homeScreen').style.display = 'none';
        document.getElementById('trashPage').style.display = 'block';
        loadTrash();
    }

    function loadTrash() {
        const list = document.getElementById('trashList');
        db.transaction("recycle_bin", "readonly").objectStore("recycle_bin").getAll().onsuccess = e => {
            list.innerHTML = e.target.result.map(f => `
                <div class="file-row">
                    <span>${f.name}</span>
                    <button class="btn btn-delete" onclick="deleteForever(${f.id})">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ</button>
                </div>`).join('') || "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©";
        };
    }

    function deleteForever(id) {
        const tx = db.transaction("recycle_bin", "readwrite");
        tx.objectStore("recycle_bin").delete(id);
        tx.oncomplete = () => { loadTrash(); updateTrashCounter(); };
    }

    function emptyTrash() {
        const tx = db.transaction("recycle_bin", "readwrite");
        tx.objectStore("recycle_bin").clear();
        tx.oncomplete = () => { loadTrash(); updateTrashCounter(); };
    }

    function closeViewer() { document.getElementById('viewer').style.display = 'none'; document.getElementById('vFrame').src = ""; }
    function goHome() { renderHome(); }
</script>
</body>
</html>